# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10xMdtrw1fMR0rdOhC0j1Hl08EQhH04FJ
"""

# Basit karbon hesaplama Ã¶rneÄŸi

# AylÄ±k elektrik tÃ¼ketimi (kWh)
electricity_kwh = 50000

# TÃ¼rkiye ortalama emisyon faktÃ¶rÃ¼ (kg CO2 / kWh)
emission_factor = 0.43

# Karbon emisyonu hesaplama
carbon_emission_kg = electricity_kwh * emission_factor

print("AylÄ±k Karbon Emisyonu (kg CO2):", carbon_emission_kg)
print("AylÄ±k Karbon Emisyonu (ton CO2):", carbon_emission_kg / 1000)

"""# ===============================
# BIOLOT - Karbon Risk Hesaplama
# ===============================

electricity_kwh = 50000
natural_gas_m3 = 10000
carbon_price_eur = 85

electricity_factor = 0.43
natural_gas_factor = 2.1

scope2_kg = electricity_kwh * electricity_factor
scope2_ton = scope2_kg / 1000

scope1_kg = natural_gas_m3 * natural_gas_factor
scope1_ton = scope1_kg / 1000

total_emission = scope1_ton + scope2_ton
financial_risk = total_emission * carbon_price_eur


print("------ BIOLOT KARBON RAPORU ------")
print("Scope 1 (DoÄŸalgaz) Ton CO2:", scope1_ton)
print("Scope 2 (Elektrik) Ton CO2:", scope2_ton)
print("Toplam Emisyon (Ton CO2):", total_emission)
print("Karbon Vergi Riski (â‚¬):", financial_risk)

"""



import pandas as pd

file_path = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

# DosyayÄ± satÄ±r satÄ±r inceleyelim
with open(file_path, "r", encoding="latin1") as f:
    lines = f.readlines()

# Ä°lk 30 satÄ±rÄ± yazdÄ±r
for i in range(30):
    print(lines[i])

import pandas as pd

file_path = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

# DosyayÄ± satÄ±r satÄ±r oku
with open(file_path, "r", encoding="latin1") as f:
    lines = f.readlines()

# -END HEADER- satÄ±rÄ±nÄ± bul
start_index = None
for i, line in enumerate(lines):
    if "-END HEADER-" in line:
        start_index = i + 1
        break

# BaÅŸlÄ±k satÄ±rÄ±
header = lines[start_index].split(";")[0].strip()

# Veri satÄ±rlarÄ±nÄ± al (sadece virgÃ¼llÃ¼ kÄ±smÄ±)
data_lines = []
for line in lines[start_index + 1:]:
    clean_part = line.split(";")[0].strip()
    data_lines.append(clean_part)

# DataFrame oluÅŸtur
from io import StringIO
csv_data = header + "\n" + "\n".join(data_lines)

df = pd.read_csv(StringIO(csv_data))

# Gerekli kolonlarÄ± al
df = df[["YEAR", "DOY", "T2M"]]

print(df.head())
print("\nToplam GÃ¼n SayÄ±sÄ±:", len(df))
# SoÄŸutma GÃ¼n Derecesi (CDD) hesapla
df["CDD"] = df["T2M"].apply(lambda x: max(0, x - 22))

print("\nCDD Ä°lk 10 GÃ¼n:")
print(df[["YEAR", "DOY", "T2M", "CDD"]].head(10))

print("\nToplam CDD:", df["CDD"].sum())
# ğŸŒ¿ Biyolojik yÃ¼zey simÃ¼lasyonu (-2Â°C)
df["T2M_bio"] = df["T2M"] - 2

# Negatif uÃ§lara karÅŸÄ± koruma (Ã§ok soÄŸuk gÃ¼nlerde sorun olmasÄ±n)
df["T2M_bio"] = df["T2M_bio"].apply(lambda x: x)

# Biyolojik CDD
df["CDD_bio"] = df["T2M_bio"].apply(lambda x: max(0, x - 22))

# Toplam karÅŸÄ±laÅŸtÄ±rma
total_cdd_ref = df["CDD"].sum()
total_cdd_bio = df["CDD_bio"].sum()

reduction_ratio = (total_cdd_ref - total_cdd_bio) / total_cdd_ref

print("\nReferans Toplam CDD:", total_cdd_ref)
print("Biyolojik Toplam CDD:", total_cdd_bio)
print("SoÄŸutma AzalÄ±ÅŸ OranÄ±:", reduction_ratio)

print("------ MÄ°KROKLÄ°MA ANALÄ°ZÄ° ------")

# 1ï¸âƒ£ Ortalama sÄ±caklÄ±k (NASA verisinden)
avg_temp = df["T2M"].mean()

# 2ï¸âƒ£ Biyolojik yÃ¼zeyin 2Â°C daha serin olduÄŸu varsayÄ±mÄ±
delta_T = 2

# 3ï¸âƒ£ LiteratÃ¼r katsayÄ±sÄ±:
# Her 1Â°C dÃ¼ÅŸÃ¼ÅŸ HVAC yÃ¼kÃ¼nÃ¼ yaklaÅŸÄ±k %3 azaltÄ±r
hvac_reduction = delta_T * 0.03

# GÃ¼venlik sÄ±nÄ±rÄ± (max %10 azaltÄ±m)
hvac_reduction = min(hvac_reduction, 0.10)

# 4ï¸âƒ£ FabrikanÄ±n yÄ±llÄ±k elektrik tÃ¼ketimi (Ã¶rnek)
total_electricity_kwh = 2500000

# HVAC payÄ± (%30 varsayÄ±m)
hvac_share = 0.30

hvac_energy = total_electricity_kwh * hvac_share
saved_energy = hvac_energy * hvac_reduction

print("Ortalama SÄ±caklÄ±k:", round(avg_temp,2))
print("HVAC AzalÄ±ÅŸ OranÄ±:", round(hvac_reduction*100,2), "%")
print("Tahmini Enerji Tasarrufu (kWh):", round(saved_energy,2))

print("------ ENERJÄ° â†’ CO2 DÃ–NÃœÅÃœMÃœ ------")

saved_energy_kwh = 45000  # Senin Ã§Ä±ktÄ±n
grid_factor_kg_per_kwh = 0.42  # TÃ¼rkiye ÅŸebeke iÃ§in varsayÄ±m (ister sonra gÃ¼ncelleriz)

saved_co2_kg = saved_energy_kwh * grid_factor_kg_per_kwh
saved_co2_ton = saved_co2_kg / 1000

print("Ã–nlenen CO2 (kg):", round(saved_co2_kg, 2))
print("Ã–nlenen CO2 (ton):", round(saved_co2_ton, 3))

print("------ CO2 â†’ KARBON MALÄ°YETÄ° (OPSÄ°YONEL) ------")

saved_co2_ton = saved_co2_ton  # bir Ã¶nceki hÃ¼creden geliyor
carbon_price_eur = 85  # Ã¶rnek ETS fiyatÄ±

avoided_cost_eur = saved_co2_ton * carbon_price_eur

print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬):", round(avoided_cost_eur, 2))

import pandas as pd
import numpy as np

print("BIOLOT Sistem BaÅŸlatÄ±ldÄ±")

# NASA verisini oku
file_path = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

df = pd.read_csv(
    file_path,
    skiprows=17,
    delimiter=","
)

# Sadece gerekli kolonlar
df = df[["YEAR", "DOY", "T2M"]]

# CDD hesapla (Base Temp = 22Â°C)
df["CDD"] = df["T2M"].apply(lambda x: max(0, x - 22))

print("Toplam GÃ¼n SayÄ±sÄ±:", len(df))
print("Toplam CDD:", round(df["CDD"].sum(), 2))

import pandas as pd

file_path = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

df = pd.read_csv(
    file_path,
    skiprows=17,
    delimiter=",",
    encoding="latin1",
    engine="python"
)

# Kolon isimlerini temizle (boÅŸluk varsa dÃ¼zelt)
df.columns = df.columns.str.strip()

# Sadece gerekli kolonlarÄ± al
df = df[["YEAR", "DOY", "T2M"]]

print(df.head())
print("\nToplam GÃ¼n SayÄ±sÄ±:", len(df))

file_path = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

# DosyanÄ±n iÃ§inden "YEAR,DOY" geÃ§en satÄ±rÄ± bulalÄ±m
with open(file_path, "r", encoding="latin1", errors="ignore") as f:
    for i, line in enumerate(f):
        if line.strip().startswith("YEAR,DOY"):
            header_line = i
            print("âœ… BaÅŸlÄ±k satÄ±rÄ± bulundu:", header_line)
            print("BaÅŸlÄ±k:", line.strip())
            break

import pandas as pd

df = pd.read_csv(
    file_path,
    skiprows=header_line,   # baÅŸlÄ±ÄŸa kadar atla
    delimiter=",",
    encoding="latin1",
    engine="python"
)

df.columns = df.columns.str.strip()
print("âœ… Kolonlar:", df.columns.tolist())
print(df.head())
print("\nToplam satÄ±r:", len(df))

df = df[["YEAR", "DOY", "T2M"]]
# Convert 'T2M' column to numeric, coercing errors to NaN
df["T2M"] = pd.to_numeric(df["T2M"], errors='coerce')
# Drop rows where 'T2M' is NaN after conversion to avoid issues
df.dropna(subset=['T2M'], inplace=True)
df["CDD"] = (df["T2M"] - 22).clip(lower=0)
print("Toplam CDD:", round(df["CDD"].sum(), 2))

import pandas as pd

# df zaten okundu varsayÄ±yorum. EÄŸer df yoksa, Ã¶nce okuma hÃ¼creni Ã§alÄ±ÅŸtÄ±r.

# 1) Kolon adlarÄ±nÄ± temizle (boÅŸluk/; varsa dÃ¼zelt)
df.columns = df.columns.astype(str).str.strip()
df.columns = [c.split(";")[0].strip() for c in df.columns]

# 2) Gerekli kolonlarÄ± seÃ§
df = df[["YEAR", "DOY", "T2M"]].copy()

# 3) T2M string -> numeric temizlik
# - virgÃ¼llÃ¼ ondalÄ±k gelirse noktaya Ã§evir
# - sayÄ±sal olmayan karakterleri temizle
df["T2M"] = (
    df["T2M"]
    .astype(str)
    .str.replace(",", ".", regex=False)
    .str.replace(r"[^0-9\.\-]+", "", regex=True)
)

df["T2M"] = pd.to_numeric(df["T2M"], errors="coerce")

# 4) Bozuk satÄ±rlarÄ± at (T2M NaN olanlar)
df = df.dropna(subset=["T2M"])

# 5) CDD hesabÄ±
BASE_TEMP = 22.0
df["CDD"] = (df["T2M"] - BASE_TEMP).clip(lower=0)

print(df.head(10))
print("\nâœ… T2M tipi:", df["T2M"].dtype)
print("âœ… Toplam satÄ±r:", len(df))
print("âœ… Toplam CDD:", round(df["CDD"].sum(), 2))

# --- 3) Mikroklima -> Enerji -> CO2 -> â‚¬ ---

# A) VarsayÄ±mlar / ayarlar
BASE_TEMP = 22.0

beta = 0.5  # bina elastikiyeti: 0.3 iyi yalÄ±tÄ±m, 0.5 standart, 0.8 kÃ¶tÃ¼
hvac_annual_kwh = 750000  # fabrikanÄ±n yÄ±llÄ±k HVAC elektrik tÃ¼ketimi (bilmiyorsan ÅŸimdilik bu kalsÄ±n)

grid_factor_kg_per_kwh = 0.42  # ÅŸebeke emisyon faktÃ¶rÃ¼ (kg CO2 / kWh) - ÅŸimdilik sabit
carbon_price_eur_per_ton = 85   # â‚¬/ton - senaryo fiyatÄ±

# B) Referans ve biyolojik senaryo (ÅŸimdilik biyolojik senaryo = T2M - delta_T kabulÃ¼)
# Not: Senin Ã¶nceki Ã¶rneÄŸinde biyolojik CDD'yi dÃ¼ÅŸÃ¼rmÃ¼ÅŸtÃ¼n. Burada da aynÄ± mantÄ±k:
delta_T = 2.4  # yeÅŸil altyapÄ±nÄ±n dÄ±ÅŸ ortamÄ± dÃ¼ÅŸÃ¼rmesi varsayÄ±mÄ± (Â°C)

df["T_ref"] = df["T2M"]
df["T_bio"] = df["T2M"] - delta_T

df["CDD_ref"] = (df["T_ref"] - BASE_TEMP).clip(lower=0)
df["CDD_bio"] = (df["T_bio"] - BASE_TEMP).clip(lower=0)

CDD_ref_total = df["CDD_ref"].sum()
CDD_bio_total = df["CDD_bio"].sum()

# C) SoÄŸutma azalÄ±ÅŸ oranÄ± (sÄ±fÄ±ra bÃ¶lÃ¼nme korumalÄ±)
if CDD_ref_total > 0:
    raw_reduction = (CDD_ref_total - CDD_bio_total) / CDD_ref_total
    cooling_reduction = max(0, raw_reduction)  # negatifse 0
else:
    cooling_reduction = 0

# D) HVAC tasarrufu: dÄ±ÅŸ ortam azalÄ±ÅŸÄ± * beta * HVAC tÃ¼ketimi
hvac_saving_kwh = hvac_annual_kwh * cooling_reduction * beta

# E) CO2 ve â‚¬ karÅŸÄ±lÄ±ÄŸÄ±
avoided_co2_kg = hvac_saving_kwh * grid_factor_kg_per_kwh
avoided_co2_ton = avoided_co2_kg / 1000
avoided_cost_eur = avoided_co2_ton * carbon_price_eur_per_ton

print("------ MÄ°KROKLÄ°MA ANALÄ°ZÄ° (3. ADIM) ------")
print("Referans Toplam CDD:", round(CDD_ref_total, 2))
print("Biyolojik Toplam CDD:", round(CDD_bio_total, 2))
print("SoÄŸutma AzalÄ±ÅŸ OranÄ±:", round(cooling_reduction, 4))
print("Beta (bina elastikiyeti):", beta)
print("Tahmini HVAC Tasarrufu (kWh/yÄ±l):", round(hvac_saving_kwh, 2))

print("\n------ CO2 â†’ â‚¬ (OPSÄ°YONEL) ------")
print("KaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(avoided_co2_ton, 3))
print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬ / yÄ±l):", round(avoided_cost_eur, 2))

# Kolon isimlerini kontrol et
print(df.columns)

# T2M tipini kontrol et
print(df["T2M"].dtype)

# EÄŸer string ise temizle
df["T2M"] = (
    df["T2M"]
    .astype(str)
    .str.replace(",", ".", regex=False)
)

df["T2M"] = pd.to_numeric(df["T2M"], errors="coerce")

# NaN satÄ±rlarÄ± temizle
df = df.dropna(subset=["T2M"])

print("\nTemizlenmiÅŸ veri tipi:", df["T2M"].dtype)
print("Ortalama SÄ±caklÄ±k:", df["T2M"].mean())

from pathlib import Path

in_path = Path("POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv")
out_path = Path("nasa_clean.csv")

lines_out = []
data_started = False

with in_path.open("r", encoding="latin1", errors="ignore") as f:
    for line in f:
        line = line.strip()
        if not line:
            continue

        # Veri baÅŸlangÄ±cÄ±nÄ± bul
        if line.startswith("YEAR,DOY"):
            data_started = True
            # sadece ';' Ã¶ncesini al
            left = line.split(";")[0].strip()
            lines_out.append(left)
            continue

        if not data_started:
            continue

        # veri satÄ±rlarÄ±: sadece ';' Ã¶ncesini al
        left = line.split(";")[0].strip()

        # bazen header sonrasÄ±nda boÅŸ/bozuk satÄ±r olur
        if left.count(",") < 2:
            continue

        lines_out.append(left)

out_path.write_text("\n".join(lines_out), encoding="utf-8")

print("âœ… Temiz dosya yazÄ±ldÄ±:", out_path)
print("âœ… SatÄ±r sayÄ±sÄ±:", len(lines_out))
print("Ã–rnek ilk 3 satÄ±r:")
print("\n".join(lines_out[:3]))

import pandas as pd

df = pd.read_csv("nasa_clean.csv")

print(df.columns)
print("SatÄ±r:", len(df))
print(df.head())

# T2M sayÄ±sal mÄ±?
df["T2M"] = pd.to_numeric(df["T2M"], errors="coerce")
df = df.dropna(subset=["T2M"])

print("\nT2M dtype:", df["T2M"].dtype)
print("Ortalama sÄ±caklÄ±k:", df["T2M"].mean())
print("Min/Max:", df["T2M"].min(), df["T2M"].max())

import numpy as np

print("------ MÄ°KROKLÄ°MA ANALÄ°ZÄ° (FINAL) ------")

# 1ï¸âƒ£ CDD HesabÄ± (Base Temp = 22Â°C)
base_temp = 22

df["CDD"] = np.where(df["T2M"] > base_temp, df["T2M"] - base_temp, 0)

total_cdd_ref = df["CDD"].sum()

print("Toplam Referans CDD:", round(total_cdd_ref,2))


# 2ï¸âƒ£ Biyolojik Alan Senaryosu (2Â°C soÄŸutma varsayÄ±mÄ±)
cooling_effect = 2

df["T_bio"] = df["T2M"] - cooling_effect
df["CDD_bio"] = np.where(df["T_bio"] > base_temp, df["T_bio"] - base_temp, 0)

total_cdd_bio = df["CDD_bio"].sum()

print("Toplam Biyolojik CDD:", round(total_cdd_bio,2))


# 3ï¸âƒ£ SoÄŸutma AzalÄ±ÅŸ OranÄ±
if total_cdd_ref > 0:
    cooling_reduction_ratio = (total_cdd_ref - total_cdd_bio) / total_cdd_ref
else:
    cooling_reduction_ratio = 0

print("SoÄŸutma AzalÄ±ÅŸ OranÄ±:", round(cooling_reduction_ratio,4))


# 4ï¸âƒ£ HVAC Enerji Tasarrufu
annual_hvac_consumption = 500000   # fabrikanÄ±n yÄ±llÄ±k soÄŸutma kWh tÃ¼ketimi (Ã¶rnek)
beta = 0.5                         # bina elastikiyeti

hvac_saving_kwh = annual_hvac_consumption * cooling_reduction_ratio * beta

print("Beta (bina elastikiyeti):", beta)
print("Tahmini HVAC Tasarrufu (kWh/yÄ±l):", round(hvac_saving_kwh,2))


# 5ï¸âƒ£ CO2 AzalÄ±ÅŸÄ±
electricity_emission_factor = 0.43  # kg CO2/kWh

avoided_co2_ton = (hvac_saving_kwh * electricity_emission_factor) / 1000

print("\n------ CO2 â†’ â‚¬ (OPSÄ°YONEL) ------")
print("KaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(avoided_co2_ton,3))


# 6ï¸âƒ£ Karbon FiyatÄ±
carbon_price_eur = 85

avoided_cost = avoided_co2_ton * carbon_price_eur

print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬ / yÄ±l):", round(avoided_cost,2))

import pandas as pd

NASA_FILE = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

# DosyayÄ± ham olarak oku
df_raw = pd.read_csv(
    NASA_FILE,
    skiprows=17,
    encoding="latin1",
    engine="python"
)

# Sadece virgÃ¼l Ã¶ncesi kolonlarÄ± al ( ; sonrasÄ± Ã§Ã¶plÃ¼k kÄ±smÄ± atÄ±lÄ±r )
df_raw.columns = df_raw.columns.str.split(";").str[0]

# Ä°lk 7 gerÃ§ek kolonu seÃ§
df = df_raw.iloc[:, 0:7]

# Kolon isimlerini temizle
df.columns = ["YEAR", "DOY", "T2M", "RH2M", "PRECTOTCORR", "WS2M", "ALLSKY_SFC_SW_DWN"]

# SayÄ±sal dÃ¶nÃ¼ÅŸÃ¼m
df["T2M"] = pd.to_numeric(df["T2M"], errors="coerce")

print("SatÄ±r SayÄ±sÄ±:", len(df))
print("\nKolonlar:", df.columns)
print("\nÄ°lk 5 SatÄ±r:")
print(df.head())

print("\nOrtalama SÄ±caklÄ±k:", df["T2M"].mean())
print("Min / Max:", df["T2M"].min(), "/", df["T2M"].max())
import pandas as pd

NASA_FILE = "POWER_Point_Daily_20050101_20250101_040d24N_028d93E_LST.csv"

df_raw = pd.read_csv(
    NASA_FILE,
    skiprows=17,
    encoding="latin1",
    engine="python"
)

# Kolon adlarÄ±nÄ± ; sonrasÄ± Ã§Ã¶pten temizle
df_raw.columns = df_raw.columns.astype(str).str.split(";").str[0]

# Ä°lk 7 gerÃ§ek kolon
df = df_raw.iloc[:, 0:7].copy()
df.columns = ["YEAR", "DOY", "T2M", "RH2M", "PRECTOTCORR", "WS2M", "ALLSKY_SFC_SW_DWN"]

# HÃ¼cre iÃ§i ; Ã§Ã¶plerini temizleyen fonksiyon
def clean_cell(x):
    if pd.isna(x):
        return None
    s = str(x)
    s = s.split(";")[0]          # ; varsa ilk parÃ§a
    s = s.replace(",", ".")      # , ondalÄ±k olursa .
    return s

# SayÄ±sala Ã§evir (hepsini gÃ¼vene alalÄ±m)
for col in ["T2M", "RH2M", "PRECTOTCORR", "WS2M", "ALLSKY_SFC_SW_DWN"]:
    df[col] = df[col].apply(clean_cell)
    df[col] = pd.to_numeric(df[col], errors="coerce")

# Bozuk satÄ±rlarÄ± at (en azÄ±ndan YEAR/DOY/T2M dolu olsun)
df = df.dropna(subset=["YEAR", "DOY", "T2M"]).reset_index(drop=True)

print("SatÄ±r SayÄ±sÄ±:", len(df))
print(df.head())

print("\nT2M dtype:", df["T2M"].dtype)
print("Ortalama sÄ±caklÄ±k:", df["T2M"].mean())
print("Min/Max:", df["T2M"].min(), df["T2M"].max())

print("\nALLSKY Ã¶rnekleri (ilk 5):")
print(df["ALLSKY_SFC_SW_DWN"].head())

import numpy as np

# --- NOSAB Ã–RNEK FABRÄ°KA VARSAYIMLARI (deÄŸiÅŸtirebilirsin) ---
BASE_TEMP = 22.0          # CDD baz sÄ±caklÄ±k
DELTA_T = 2.4             # yeÅŸil altyapÄ± ile dÄ±ÅŸ ortam soÄŸutma etkisi (Â°C)
BETA = 0.5                # bina elastikiyeti (0.3 iyi, 0.5 normal, 0.8 kÃ¶tÃ¼)

HVAC_KWH_YEAR = 2500000   # fabrikanÄ±n yÄ±llÄ±k HVAC elektrik tÃ¼ketimi (kWh/yÄ±l) - Ã¶rnek
GRID_FACTOR_KG_PER_KWH = 0.43  # ÅŸebeke emisyon faktÃ¶rÃ¼ (kg CO2 / kWh) - Ã¶rnek
CARBON_PRICE_EUR = 85.5        # â‚¬/ton - Ã¶rnek

# --- CDD hesaplarÄ± ---
df2 = df.copy()

# Referans dÄ±ÅŸ sÄ±caklÄ±k = T2M (NASA)
df2["T_ref"] = df2["T2M"]

# Biyolojik senaryo = dÄ±ÅŸ sÄ±caklÄ±k DELTA_T kadar dÃ¼ÅŸsÃ¼n
df2["T_bio"] = df2["T2M"] - DELTA_T

# CDD hesapla
df2["CDD_ref"] = np.maximum(0, df2["T_ref"] - BASE_TEMP)
df2["CDD_bio"] = np.maximum(0, df2["T_bio"] - BASE_TEMP)

total_cdd_ref = df2["CDD_ref"].sum()
total_cdd_bio = df2["CDD_bio"].sum()

# SÄ±fÄ±ra bÃ¶lÃ¼nme korumasÄ±
if total_cdd_ref > 0:
    cooling_reduction = (total_cdd_ref - total_cdd_bio) / total_cdd_ref
    cooling_reduction = max(0, cooling_reduction)  # negatif koruma
else:
    cooling_reduction = 0.0

# Beta ile bina iÃ§i HVAC etkisi
hvac_reduction = cooling_reduction * BETA

# YÄ±llÄ±k HVAC tasarrufu (kWh)
saved_hvac_kwh = HVAC_KWH_YEAR * hvac_reduction

# CO2 kaÃ§Ä±nÄ±mÄ± (ton/yÄ±l)
saved_co2_ton = (saved_hvac_kwh * GRID_FACTOR_KG_PER_KWH) / 1000

# â‚¬ karÅŸÄ±lÄ±ÄŸÄ±
saved_eur = saved_co2_ton * CARBON_PRICE_EUR

# --- RAPOR ---
print("------ MÄ°KROKLÄ°MA ANALÄ°ZÄ° (3. ADIM) ------")
print("SatÄ±r sayÄ±sÄ±:", len(df2), "(Not: 7306 beklenir, sizde 7302 var -> ilk gÃ¼nler eksik olabilir)")
print("Ortalama T2M (Â°C):", round(df2["T2M"].mean(), 2))
print("Toplam Referans CDD:", round(total_cdd_ref, 2))
print("Toplam Biyolojik CDD:", round(total_cdd_bio, 2))
print("SoÄŸutma AzalÄ±ÅŸ OranÄ±:", round(cooling_reduction, 4))
print("Beta (bina elastikiyeti):", BETA)
print("Tahmini HVAC Tasarrufu (kWh/yÄ±l):", round(saved_hvac_kwh, 2))

print("\n------ CO2 â†’ â‚¬ (OPSÄ°YONEL) ------")
print("KaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(saved_co2_ton, 3))
print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬ / yÄ±l):", round(saved_eur, 2))

# ---- GERÃ‡EKÃ‡Ä° HVAC MODELÄ° ----

DELTA_T = 2.4
BETA = 0.5
HVAC_KWH_YEAR = 2500000
GRID_FACTOR_KG_PER_KWH = 0.43
CARBON_PRICE_EUR = 85.5

# 1Â°C baÅŸÄ±na %4 enerji azalÄ±mÄ±
ENERGY_SENSITIVITY = 0.04

external_energy_effect = DELTA_T * ENERGY_SENSITIVITY
hvac_reduction = external_energy_effect * BETA

saved_hvac_kwh = HVAC_KWH_YEAR * hvac_reduction
saved_co2_ton = (saved_hvac_kwh * GRID_FACTOR_KG_PER_KWH) / 1000
saved_eur = saved_co2_ton * CARBON_PRICE_EUR

print("------ DÃœZELTÄ°LMÄ°Å MÄ°KROKLÄ°MA MODELÄ° ------")
print("DÄ±ÅŸ Ortam Enerji Etkisi (%):", round(external_energy_effect*100,2))
print("GerÃ§ek HVAC AzalÄ±ÅŸÄ± (%):", round(hvac_reduction*100,2))
print("HVAC Tasarrufu (kWh/yÄ±l):", round(saved_hvac_kwh,2))
print("KaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(saved_co2_ton,3))
print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬ / yÄ±l):", round(saved_eur,2))

# ---- NOSAB Ã–RNEK FABRÄ°KA (SENARYO VERÄ°LERÄ°) ----

factory = {
    "name": "NOSAB Ã–rnek Tekstil FabrikasÄ±",
    "area_m2": 20000,

    # YÄ±llÄ±k tÃ¼ketimler (Ã¶rnek)
    "electricity_kwh_year": 2500000,     # 2.5 GWh/yÄ±l
    "natural_gas_m3_year": 180000,       # 180k m3/yÄ±l

    # Emisyon faktÃ¶rleri
    "grid_factor_kg_per_kwh": 0.43,      # kgCO2/kWh
    "gas_factor_kg_per_m3": 2.0,         # kgCO2/m3 (basit yaklaÅŸÄ±m)

    # Karbon fiyatÄ±
    "carbon_price_eur_per_ton": 85.5,

    # Su tarafÄ± (Ã¶rnek)
    "water_baseline_m3_year": 12000,     # sistem yokken
    "water_actual_m3_year": 8000,        # BIOLOT sonrasÄ±
    "pump_energy_index_kwh_per_m3": 0.4  # kWh/m3
}

factory

# ---- 1) KARBON MOTORU (Scope 1 + Scope 2) ----
e_kwh = factory["electricity_kwh_year"]
g_m3  = factory["natural_gas_m3_year"]

grid_factor = factory["grid_factor_kg_per_kwh"]
gas_factor  = factory["gas_factor_kg_per_m3"]
carbon_price = factory["carbon_price_eur_per_ton"]

scope2_ton = (e_kwh * grid_factor) / 1000
scope1_ton = (g_m3  * gas_factor)  / 1000

total_ton = scope1_ton + scope2_ton
carbon_risk_eur = total_ton * carbon_price


# ---- 2) MÄ°KROKLÄ°MA (SENÄ°N DÃœZELTÄ°LMÄ°Å MODEL SONUCUN) ----
delta_t = 2.4
beta = 0.5
energy_sensitivity = 0.04  # 1Â°C baÅŸÄ±na %4

external_energy_effect = delta_t * energy_sensitivity
hvac_reduction = external_energy_effect * beta

hvac_saved_kwh = e_kwh * hvac_reduction
hvac_saved_co2_ton = (hvac_saved_kwh * grid_factor) / 1000
hvac_saved_eur = hvac_saved_co2_ton * carbon_price


# ---- 3) SU TASARRUFU (Baseline - Actual) + Pompa Enerjisi ----
water_base = factory["water_baseline_m3_year"]
water_act  = factory["water_actual_m3_year"]
pump_idx   = factory["pump_energy_index_kwh_per_m3"]

saved_water_m3 = max(0, water_base - water_act)
water_status = "SUCCESS_SAVINGS" if water_base - water_act >= 0 else "WARNING_EXCESS_CONSUMPTION"

saved_pump_kwh = saved_water_m3 * pump_idx
saved_pump_co2_ton = (saved_pump_kwh * grid_factor) / 1000
saved_pump_eur = saved_pump_co2_ton * carbon_price


# ---- 4) TOPLAM Ã–ZET ----
total_saved_kwh = hvac_saved_kwh + saved_pump_kwh
total_saved_co2_ton = hvac_saved_co2_ton + saved_pump_co2_ton
total_saved_eur = hvac_saved_eur + saved_pump_eur

print("\n===============================")
print("ğŸ­ BIOLOT YILLIK Ã–ZET RAPORU")
print("===============================")
print("Fabrika:", factory["name"])
print("Alan (mÂ²):", factory["area_m2"])

print("\n--- KARBON (Scope 1 + Scope 2) ---")
print("Scope 1 (DoÄŸalgaz) ton CO2:", round(scope1_ton, 2))
print("Scope 2 (Elektrik) ton CO2:", round(scope2_ton, 2))
print("Toplam Emisyon ton CO2:", round(total_ton, 2))
print("Karbon Riski (â‚¬ / yÄ±l):", round(carbon_risk_eur, 2))

print("\n--- MÄ°KROKLÄ°MA / HVAC ---")
print("Delta T (Â°C):", delta_t)
print("HVAC AzalÄ±ÅŸÄ± (%):", round(hvac_reduction*100, 2))
print("HVAC Tasarrufu (kWh/yÄ±l):", round(hvac_saved_kwh, 0))
print("KaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(hvac_saved_co2_ton, 3))
print("KaÃ§Ä±nÄ±lan Karbon Maliyeti (â‚¬ / yÄ±l):", round(hvac_saved_eur, 2))

print("\n--- SU / POMPA ---")
print("Baseline su (mÂ³/yÄ±l):", water_base)
print("GerÃ§ek su (mÂ³/yÄ±l):", water_act)
print("Durum:", water_status)
print("KurtarÄ±lan su (mÂ³/yÄ±l):", round(saved_water_m3, 0))
print("Pompa enerji tasarrufu (kWh/yÄ±l):", round(saved_pump_kwh, 0))
print("Pompa CO2 kazancÄ± (ton/yÄ±l):", round(saved_pump_co2_ton, 3))
print("Pompa karbon maliyeti kazancÄ± (â‚¬ / yÄ±l):", round(saved_pump_eur, 2))

print("\n--- TOPLAM OPERASYONEL KAZANÃ‡ (HVAC + Pompa) ---")
print("Toplam enerji tasarrufu (kWh/yÄ±l):", round(total_saved_kwh, 0))
print("Toplam kaÃ§Ä±nÄ±lan CO2 (ton/yÄ±l):", round(total_saved_co2_ton, 3))
print("Toplam kaÃ§Ä±nÄ±lan karbon maliyeti (â‚¬ / yÄ±l):", round(total_saved_eur, 2))

# ---- AYLIK NASA ANALÄ°ZÄ° ----

import pandas as pd

# Tarih oluÅŸtur
df["DATE"] = pd.to_datetime(df["YEAR"].astype(str) + "-" + df["DOY"].astype(str), format="%Y-%j")

# Ay bilgisi ekle
df["MONTH"] = df["DATE"].dt.month

# AylÄ±k ortalama sÄ±caklÄ±k
monthly_avg = df.groupby("MONTH")["T2M"].mean()

# AylÄ±k CDD
base_temp = 22
df["CDD"] = df["T2M"].apply(lambda x: max(0, x - base_temp))
monthly_cdd = df.groupby("MONTH")["CDD"].sum()

print("------ AYLIK ORTALAMA SICAKLIK (Â°C) ------")
print(monthly_avg)

print("\n------ AYLIK TOPLAM CDD ------")
print(monthly_cdd)

# ---- AYLIK HVAC TASARRUF MODELÄ° ----

annual_hvac_consumption = 2500000  # kWh
real_reduction_rate = 0.048        # %4.8

annual_saving = annual_hvac_consumption * real_reduction_rate

# YÄ±llÄ±k toplam CDD
total_cdd_year = monthly_cdd.sum()

# Her ayÄ±n CDD oranÄ±
monthly_ratio = monthly_cdd / total_cdd_year

# AylÄ±k enerji tasarrufu
monthly_energy_saving = monthly_ratio * annual_saving

# CO2 hesap
electricity_factor = 0.43  # kg CO2/kWh
carbon_price = 85          # â‚¬/ton

monthly_co2_kg = monthly_energy_saving * electricity_factor
monthly_co2_ton = monthly_co2_kg / 1000
monthly_euro = monthly_co2_ton * carbon_price

print("------ AYLIK BIOLOT RAPORU ------")
for month in range(1, 13):
    print(
        f"Ay {month}: "
        f"Tasarruf {monthly_energy_saving.get(month,0):.0f} kWh | "
        f"CO2 {monthly_co2_ton.get(month,0):.2f} ton | "
        f"â‚¬ {monthly_euro.get(month,0):.2f}"
    )

